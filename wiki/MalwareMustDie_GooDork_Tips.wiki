#GooDork Tips for Mac OS-X - for the usage to analyze and to confirm web-based malicious infection cases.

= Introduction =

Due to checking the web-base malware infection in the internet that is rapidly grow, we think is necessary to share to fellow researchers and authority the simple tool that is very useful for analysis malware infected sites. Like most of you do do, thank's to  Google for their hard work in search engine, we are using Dork for this purpose. Since most of our members works in a shell than UI environment we found and now share the good UI tools developed and maintained by @k3170Makan (twitter) in Git called GooDork, a python base command line interface for dork.

= Notes & Credits =

Google Search is copyright by Google,.Inc. to be used accordingly under the below policy and term of service only:
<https://www.google.com/intl/en/policies/>
This article, the writer, the publisher entity or the author of the tool is not responsible and forbid the improper used of the current tool. The tool can be used as per it is (and to be noted) without any warranty.
GooDork project is created & maintained by @k3170Makan (Twitter) shared  GitHub (github.com) with the following access URL: <https://github.com/k3170makan/GooDork>. With the following license information:
<https://github.com/k3170makan/GooDork/blob/master/LICENSE>. 

GooDork is copyrighted under GNU General Public License. 

We thank @k3170Makan (twitter) for letting us use and share the good tool, and to @0xerror (twitter) for introduction.

= Details =


* Requirement *

It is important that you have the Mac OS-X with the Mac Port installed. 
Please get it from here The MacPorts Project  <http://www.macports.org>

You need to check the python version, with firstly just double taps your python command in shell to know which python commands are available in your system. i.e.:
{{{
$ python [double taps]

python            python2.5         python2.6         python2.7         python3.2         python3.3         
pythonw           pythonw2.6        pythonw3.2        python-config     python2.5-config  python2.6-config  
python2.7-config  python3.2-config  python3.3-config  pythonw2.5        pythonw2.7        pythonw3.3 
}}}

Secondly, assuming you now have an updated mac ports, try below command to know which python package is installed, i.e.:
{{{
$ sudo port installed|grep python
Password:
  python27 @2.7.3_1
  python27 @2.7.5_0 (active)
  python32 @3.2.5_0 (active)
  python33 @3.3.1_0
  python33 @3.3.2_0 (active)
  python_select @0.3_2 (active)

// or.. the below command with same result:

$ sudo port installed python*
The following ports are currently installed:
  python27 @2.7.3_1
  python27 @2.7.5_0 (active)
  python32 @3.2.5_0 (active)
  python33 @3.3.1_0
  python33 @3.3.2_0 (active)
  python_select @0.3_2 (active)
}}}


You need to get the beautifulsoup now, mac ports is preparing those versions that depends on your python versions. This is how you confirm the version of beautifulsoup via MacPorts:
{{{
$ sudo port search BeautifulSoup
py-beautifulsoup @3.2.1 (python, textproc)
    Python HTML/XML parser

py-beautifulsoup4 @4.1.1 (python, textproc)
    Python HTML/XML parser

py24-beautifulsoup @3.2.1 (python, textproc)
    Python HTML/XML parser

py25-beautifulsoup @3.2.1 (python, textproc)
    Python HTML/XML parser

py25-beautifulsoup4 @4.1.1 (python, textproc)
    Python HTML/XML parser

py26-beautifulsoup @3.2.1 (python, textproc)
    Python HTML/XML parser

py26-beautifulsoup4 @4.1.1 (python, textproc)
    Python HTML/XML parser

py27-beautifulsoup @3.2.1 (python, textproc)
    Python HTML/XML parser

py27-beautifulsoup4 @4.1.1 (python, textproc)
    Python HTML/XML parser

py31-beautifulsoup4 @4.1.1 (python, textproc)
    Python HTML/XML parser

py32-beautifulsoup4 @4.1.1 (python, textproc)
    Python HTML/XML parser

Found 11 ports.
}}}

In my case I preparing python 3.2 and 2.7
{{{
// for python2.7
$ sudo port install py27-beautifulsoup4
--->  Computing dependencies for py27-beautifulsoup4
--->  Dependencies to be installed: py27-html5lib py27-distribute py27-lxml
--->  Fetching archive for py27-distribute
--->  Attempting to fetch py27-distribute-0.6.45_0.darwin_12.noarch.tbz2 from http://jog.id.packages.macports.org/macports/packages/py27-distribute
--->  Attempting to fetch py27-distribute-0.6.45_0.darwin_12.noarch.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py27-distribute
--->  Installing py27-distribute @0.6.45_0
--->  Activating py27-distribute @0.6.45_0
--->  Cleaning py27-distribute
--->  Fetching archive for py27-html5lib
--->  Attempting to fetch py27-html5lib-0.95_0.darwin_12.noarch.tbz2 from http://jog.id.packages.macports.org/macports/packages/py27-html5lib
--->  Attempting to fetch py27-html5lib-0.95_0.darwin_12.noarch.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py27-html5lib
--->  Installing py27-html5lib @0.95_0
--->  Activating py27-html5lib @0.95_0
--->  Cleaning py27-html5lib
--->  Fetching archive for py27-lxml
--->  Attempting to fetch py27-lxml-3.2.1_0.darwin_12.x86_64.tbz2 from http://jog.id.packages.macports.org/macports/packages/py27-lxml
--->  Attempting to fetch py27-lxml-3.2.1_0.darwin_12.x86_64.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py27-lxml
--->  Installing py27-lxml @3.2.1_0
--->  Activating py27-lxml @3.2.1_0
--->  Cleaning py27-lxml
--->  Fetching archive for py27-beautifulsoup4
--->  Attempting to fetch py27-beautifulsoup4-4.1.1_0+html5lib+lxml.darwin_12.noarch.tbz2 from http://jog.id.packages.macports.org/macports/packages/py27-beautifulsoup4
--->  Attempting to fetch py27-beautifulsoup4-4.1.1_0+html5lib+lxml.darwin_12.noarch.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py27-beautifulsoup4
--->  Installing py27-beautifulsoup4 @4.1.1_0+html5lib+lxml
--->  Activating py27-beautifulsoup4 @4.1.1_0+html5lib+lxml
--->  Cleaning py27-beautifulsoup4
--->  Updating database of binaries: 100.0%
--->  Scanning binaries for linking errors: 100.0%
--->  No broken files found.

// for python2.7
$ sudo port install py32-beautifulsoup4
Password:
--->  Computing dependencies for py32-beautifulsoup4
--->  Dependencies to be installed: py32-html5lib py32-distribute python32 py32-lxml libxml2 libxslt
--->  Fetching archive for python32
--->  Attempting to fetch python32-3.2.5_0.darwin_12.x86_64.tbz2 from http://jog.id.packages.macports.org/macports/packages/python32
--->  Attempting to fetch python32-3.2.5_0.darwin_12.x86_64.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/python32
--->  Installing python32 @3.2.5_0
--->  Activating python32 @3.2.5_0

To make python 3.2 the default (i.e. the version you get when you run 'python'), please run:

sudo port select --set python python32

--->  Cleaning python32
--->  Fetching archive for py32-distribute
--->  Attempting to fetch py32-distribute-0.6.45_0.darwin_12.noarch.tbz2 from http://jog.id.packages.macports.org/macports/packages/py32-distribute
--->  Attempting to fetch py32-distribute-0.6.45_0.darwin_12.noarch.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py32-distribute
--->  Installing py32-distribute @0.6.45_0
--->  Activating py32-distribute @0.6.45_0
--->  Cleaning py32-distribute
--->  Fetching archive for py32-html5lib
--->  Attempting to fetch py32-html5lib-0.95_0.darwin_12.noarch.tbz2 from http://jog.id.packages.macports.org/macports/packages/py32-html5lib
--->  Attempting to fetch py32-html5lib-0.95_0.darwin_12.noarch.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py32-html5lib
--->  Installing py32-html5lib @0.95_0
--->  Activating py32-html5lib @0.95_0
--->  Cleaning py32-html5lib
--->  Fetching archive for libxml2
--->  Attempting to fetch libxml2-2.9.0_0.darwin_12.x86_64.tbz2 from http://jog.id.packages.macports.org/macports/packages/libxml2
--->  Attempting to fetch libxml2-2.9.0_0.darwin_12.x86_64.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/libxml2
--->  Installing libxml2 @2.9.0_0
--->  Activating libxml2 @2.9.0_0
--->  Cleaning libxml2
--->  Fetching archive for libxslt
--->  Attempting to fetch libxslt-1.1.27_0.darwin_12.x86_64.tbz2 from http://jog.id.packages.macports.org/macports/packages/libxslt
--->  Attempting to fetch libxslt-1.1.27_0.darwin_12.x86_64.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/libxslt
--->  Installing libxslt @1.1.27_0
--->  Activating libxslt @1.1.27_0
--->  Cleaning libxslt
--->  Fetching archive for py32-lxml
--->  Attempting to fetch py32-lxml-3.2.1_0.darwin_12.x86_64.tbz2 from http://jog.id.packages.macports.org/macports/packages/py32-lxml
--->  Attempting to fetch py32-lxml-3.2.1_0.darwin_12.x86_64.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py32-lxml
--->  Installing py32-lxml @3.2.1_0
--->  Activating py32-lxml @3.2.1_0
--->  Cleaning py32-lxml
--->  Fetching archive for py32-beautifulsoup4
--->  Attempting to fetch py32-beautifulsoup4-4.1.1_0+html5lib+lxml.darwin_12.noarch.tbz2 from http://jog.id.packages.macports.org/macports/packages/py32-beautifulsoup4
--->  Attempting to fetch py32-beautifulsoup4-4.1.1_0+html5lib+lxml.darwin_12.noarch.tbz2.rmd160 from http://jog.id.packages.macports.org/macports/packages/py32-beautifulsoup4
--->  Installing py32-beautifulsoup4 @4.1.1_0+html5lib+lxml
--->  Activating py32-beautifulsoup4 @4.1.1_0+html5lib+lxml
--->  Cleaning py32-beautifulsoup4
--->  Updating database of binaries: 100.0%
--->  Scanning binaries for linking errors: 100.0%
--->  No broken files found.
}}}

* Installation *

Now it is time to download the latest GooDork from git, which is requiring git package (please install it via MacPorts/source beforehand):
{{{
$ git clone https://github.com/k3170makan/GooDork.git
Cloning into 'GooDork'...
remote: Counting objects: 80, done.
remote: Compressing objects: 100% (39/39), done.
remote: Total 80 (delta 37), reused 79 (delta 37)
Unpacking objects: 100% (80/80), done.
}}}

Enter the dir and here's the files:
{{{
$ cd GooDork/;ls -alF
total 152
drwxr-xr-x  17 xxxx  xxxx   578 Jun  8 02:45 ./
drwxr-xr-x   3 xxxx  xxxx   102 Jun  8 02:45 ../
drwxr-xr-x  13 xxxx  xxxx   442 Jun  8 02:45 .git/
-rw-r--r--   1 xxxx  xxxx  1008 Jun  8 02:45 Banner
-rw-r--r--   1 xxxx  xxxx  1483 Jun  8 02:45 EXAMPLES
-rwxr-xr-x   1 xxxx  xxxx  6801 Jun  8 02:45 GooDork.py*
-rw-r--r--   1 xxxx  xxxx   665 Jun  8 02:45 LICENSE
-rw-r--r--   1 xxxx  xxxx   998 Jun  8 02:45 NEW_FEATURES
-rwxr-xr-x   1 xxxx  xxxx  8526 Jun  8 02:45 Operator.py*
-rw-r--r--   1 xxxx  xxxx  7452 Jun  8 02:45 Operator.pyc
-rw-r--r--   1 xxxx  xxxx  2311 Jun  8 02:45 README
-rwxr-xr-x   1 xxxx  xxxx  4034 Jun  8 02:45 Result.py*
-rw-r--r--   1 xxxx  xxxx  4255 Jun  8 02:45 Result.pyc
-rwxr-xr-x   1 xxxx  xxxx   971 Jun  8 02:45 URLStripper.py*
-rw-r--r--   1 xxxx  xxxx  1490 Jun  8 02:45 URLStripper.pyc
-rwxr-xr-x   1 xxxx  xxxx  2562 Jun  8 02:45 netlib.py*
-rw-r--r--   1 xxxx  xxxx  3144 Jun  8 02:45 netlib.pyc
}}}

Test it with the below command depends on your python command line settings, mine is as per follows:
{{{
$ python2.7 GooDork.py 
                                                                 
     _/_/_/                   _/_/_/                     _/      
  _/         _/_/     _/_/   _/    _/   _/_/   _/  _/_/ _/  _/   
 _/  _/_/ _/    _/ _/    _/ _/    _/ _/    _/ _/_/     _/_/      
_/    _/ _/    _/ _/    _/ _/    _/ _/    _/ _/       _/  _/     
 _/_/_/   _/_/     _/_/   _/_/_/     _/_/   _/       _/    _/    
                                                                 
                                                                 
                                        _             _  _______ _ _____ ____  
                                       | |__  _   _  | |/ /___ /| |___  / /\ \ 
                                       | '_ \| | | | | / /  |_ \| |  / / |  | |
                                       | |_) | |_| | | \ \ ___) | | / /| |  | |
                                       |_.__/ \__, | | |\_\____/| |/_/ | |  | |
                                              |___/  |_|        |_|     \_\/_/ 

===================================
.::GooDork::. 2.0

Usage: ./GooDork [dork] {-b[pattern]|-t[pattern]|-a[pattern]}

dork			-- google search query
pattern			-- a regular expression to search for
-b			-- search the displayable text of the dork results for 'pattern'
-t			-- search the titles of the dork results for 'pattern'
-u			-- search the urls of the dork results for 'pattern'
-a			-- search in the anchors of the dork results for 'pattern'
-L			-- Limit the amount of restults processed to the first L results
-U			-- Custom User-agent
e.g ./GooDork site:.edu -bStudents #returns urls to all pages in the .edu domain displaying 'Students'

// if you see the optional parameter above you'll know that GooDork supported in all possible
// Dork commands, for better details please see the examples that the author shares in here:
// https://github.com/k3170makan/GooDork/blob/master/EXAMPLES
// for more of base command for security purpose you can use this site as reference:
// http://new-hack4rt.blogspot.jp/2012/07/google-dork-for-finding-website-vuln.html
}}}

That's it! your GooDork is downloaded and "installed". It downloaded the source to be executed via python, so please setup the python environment  and the path to call the installation directory properly. In the next section we will go to the simple example and practical use for malware research purpose.

* Basic Malware Research Usage's Example *

This section will explain some example on how to use the GooDork, this section will be properly updates with some samples too. ( I am sorry Keith, to please allow me to cut the banner for the space efficient purpose..)

* Example 1 - * Searching for the possible redirected malware url which ended with "cnt.php", let's define the search as google. The command line will be as follow:
{{{
$ python2.7 ./GooDork.py inurl:"cnt.php"
}}}
Which will burped you the below result in stdout:
{{{
[..banner skipped, with apology..]

===================================
[('-U', 'google-bot')]
User-Agent was set to [google-bot]
Searching >>inurl:cnt.php<<


200
OKDate: Fri, 07 Jun 2013 18:24:27 GMT
Expires: -1
Cache-Control: private, max-age=0
Content-Type: text/html; charset=ISO-8859-1
Set-Cookie: PREF=ID=f88abf28b33ff5f2:FF=0:TM=1370629467:LM=1370629467:S=TMg_PS9RzM1A1d_6; expires=Sun, 07-Jun-2015 18:24:27 GMT; path=/; domain=.google.com
Set-Cookie: NID=67=S87PEINu6bOPl1FVUnJ_TGvUeHZw2gqQvudaeM9kOPQ9s0pU7vvK2is_cvF00-o5aHQ2Cg9lPgKZbXdRk_RTD7lt5JMFs3FgtftzDClAg46sdRSIWViPTdOX2tSHxuCy; expires=Sat, 07-Dec-2013 18:24:27 GMT; path=/; domain=.google.com; HttpOnly
P3P: CP="This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&answer=151657 for more info."
Server: gws
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
 
['http://www.liscindianapolis.org/cnt.php%3Fid%3D179', 'http://www16.atpages.jp/kurobe29/1109/PHP/cnt.php.html', 'http://www.swgsoft.com/cnt.php', 'http://two.flash-gear.com/ncnt/cnt.php%3Fid%3D81179%26a%3D1045804613%26c%3D1479092445', 'http://www.roti.jp/en/cnt.php', 'http://code.google.com/p/sm-ecstasymusicplayer/source/browse/trunk/web-upload/cnt.php%3Fr%3D13', 
  :
}}}
Or..you'll see the result in file here, i.e. similar request with the other session:
{{{
$ head {PATH TO THE GOODORK DIR}/results.txt 
http://www.estudieenelexterior.com/new/scripts/contenidos/cnt.php?page=33&i=3
http://eintimex.org/epages/eshop270012.sf/en_GB/http/www.etracker.de/cnt.php/?ObjectPath=/Shops/eshop270012/Products/W44557&ViewAction=ViewProductDetailImage
http://count1.51much.com/cnt.php?uid=VA-1-13479&style=none
http://www.texaswoodcarversguild.com/student-cnt.php
http://www.shair-show.com/en/cnt.php?id=39
http://www.pamc.net/cnt.php
http://www.boidenzucht.com/cnt.php?cnt=abz&kat=544&PHPSESSID=kg24b8pqaep14ivrgu2cpe6l12
http://www.ehron.de/index.cnt.php%3Fid=3
    :
}}}
To search a blackhole exploit kit landing page of main.php in the rogue .biz domains you can use this command:
{{{
$ python2.7 GooDork.py inurl:main.php site:.biz 
}}}
The result will be:
{{{
[..banner skipped, with apology..]

===================================
[]
Searching >>inurl:main.php<<


200
OKDate: Sat, 08 Jun 2013 17:35:57 GMT
Expires: -1
Cache-Control: private, max-age=0
Content-Type: text/html; charset=ISO-8859-1
Set-Cookie: PREF=ID=2483986414a2dd36:FF=0:TM=1370712957:LM=1370712957:S=ygtvMqMalb0AejfB; expires=Mon, 08-Jun-2015 17:35:57 GMT; path=/; domain=.google.com
Set-Cookie: NID=67=R-x5nRizxtVqI3ZJ3xQ7IOlXPI2RHVAZ0fNUkcmVrk2BopSgEUGtnx-NYWkrjVBBCDaht0ow1rPLnv57Ixls6SJZkei5wWF5Zh_6v0PutKERJzXzMLQT6xOeFRS3t29i; expires=Sun, 08-Dec-2013 17:35:57 GMT; path=/; domain=.google.com; HttpOnly
P3P: CP="This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&answer=151657 for more info."
Server: gws
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
 
['http://wl.igg.com/main.php', 'http://www.wordcount.org/main.php', 'http://www.reversebeacon.net/main.php', 'http://aps.unmc.edu/AP/main.php', 'http://www.citylinkexpress.com/main.php', 'http://www.ilc.org/index-main.php', 'http://thelovemagazine.co.uk/main.php', 'http://webmail.numericable.fr/ncn/auth/main.php', 'http://vampirefreaks.com/main.php', 'http://www.metismuseum.ca/main.php', 'http://nordkapp.livecam360.com/cam3/flash/main.php', 'http://www.ncparks.gov/Visit/parks/haro/main.php', 'http://www.ncparks.gov/Visit/parks/foma/main.php', 
   :
}}}
For example you want to seek some specific file of the backbone system of Malware Infector Tools/ Exploit Kit but you don't want to be very honest about how you seek them, you can set the user agent as Mozilla as per below:
{{{
$ python2.7 GooDork.py inurl:stat.php site:.com -uMozilla
                                                                 
[..banner skipped, with apology..]

===================================
[]
Searching >>inurl:stat.php<<


200
OKDate: Sat, 08 Jun 2013 17:40:29 GMT
Expires: -1
Cache-Control: private, max-age=0
Content-Type: text/html; charset=ISO-8859-1
Set-Cookie: PREF=ID=c43dcf18d4cf54b3:FF=0:TM=1370713229:LM=1370713229:S=j11UmDQiLEMcRWNB; expires=Mon, 08-Jun-2015 17:40:29 GMT; path=/; domain=.google.com
Set-Cookie: NID=67=wJU_KJqAvXlKnXKZeeoaOUPMNRBGHHxxUeo-WMm7TUfzttINh48PigarndpsDdMrOHiUgs7XyEirk5FEnD08QWFeekhlmueKvuHu0KfD0dfpWDszsrmG7yJLDuSt5qTj; expires=Sun, 08-Dec-2013 17:40:29 GMT; path=/; domain=.google.com; HttpOnly
P3P: CP="This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&answer=151657 for more info."
Server: gws
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
 
['http://php.net/manual/fr/function.stat.php', 'http://php.net/manual/en/mysqli.stat.php', 'http://www.w3resource.com/php/function-reference/stat.php', 'http://www.southperry.net/stat.php', 'http://gm.mivabe.nl/regions/stat.php', 'http://www.lephpfacile.com/manuel-php/function.stat.php', 'http://il2track.tspace.ru/om/browser/IL-2%2520FreeHost/stat/php/auth.php%3Frev%3D217', 'http://www.autorijschooldjanssen.nl/stat.php', 'http://hae.enzim.hu/stat.php', 'http://code.svn.wordpress.org/jobs/www/_jobs/stat.php', 'http://hyips-analysis.com/stat.php', 'http://trac.php-tools.net/patTemplate/browser/trunk/patTemplate/Stat.php', 'http://www.formikaio.it/formika/prog/stat.php'
}}}